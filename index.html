<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paul Trujillo</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- estilos simplificados para la cita --- */
        body { font-family: 'Montserrat', sans-serif; line-height: 1.6; color: #333; background-color: #fdfdfd; }
        .appointment-section { padding: 80px 50px; background-color: #fff7ec; text-align:center; }
        .appointment-section h2 { font-size:2.3rem; color:#ff4e50; margin-bottom:20px; }
        .appointment-form { max-width:600px; margin:auto; display:flex; flex-direction:column; gap:15px; }
        .appointment-form input, .appointment-form textarea { padding:12px; border-radius:10px; border:1px solid #ddd; font-size:1rem; }
        .appointment-form button { padding:14px; background-color:#ff4e50; color:white; border:none; font-size:1.1rem; border-radius:25px; cursor:pointer; transition:0.3s; }
        .appointment-form button:hover { background-color:#e64345; }
        .button-group { display:flex; justify-content:center; gap:10px; margin-top:10px; }
    </style>
</head>
<body>

<section id="appointment" class="appointment-section">
    <h2>Agenda una cita conmigo</h2>
    <p>Reserva una llamada de 15 a 30 minutos para hablar de tu proyecto, negocio o idea.</p>

    <div class="appointment-form" id="appointmentForm">
        <input type="text" name="name" placeholder="Tu nombre" required>
        <input type="email" name="email" placeholder="Tu correo" required>
        <input type="datetime-local" name="datetime" required>
        <textarea name="message" placeholder="¿Qué te gustaría platicar?" rows="4"></textarea>

        <div class="button-group">
            <button type="button" id="btnGoogle">Agendar en Google Calendar</button>
            <button type="button" id="btnApple">Descargar para Apple/Outlook</button>
        </div>
    </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("appointmentForm");

    const getFormData = () => {
        const formData = new FormData(form);
        const start = formData.get("datetime");
        const endDate = new Date(start);
        endDate.setMinutes(endDate.getMinutes() + 30); // Duración 30 min
        return {
            name: formData.get("name"),
            email: formData.get("email"),
            message: formData.get("message"),
            start: new Date(start).toISOString(),
            end: endDate.toISOString()
        };
    };

    document.getElementById("btnGoogle").addEventListener("click", async () => {
        const data = getFormData();
        try {
            const res = await fetch("https://portfolio-production-1cfa.up.railway.app/create-event", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            if(result.success){
                alert("Cita creada en Google Calendar! Revisa tu calendario.");
                form.reset();
            } else {
                alert("Error: " + result.error);
            }
        } catch(err){
            alert("Error al conectar con el backend: " + err);
        }
    });

    document.getElementById("btnApple").addEventListener("click", () => {
        const data = getFormData();
        const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Paul Trujillo//Appointment//EN
BEGIN:VEVENT
UID:${Date.now()}@paultrujillo.com
DTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').split('.')[0]}Z
DTSTART:${data.start.replace(/[-:]/g,'').split('.')[0]}
DTEND:${data.end.replace(/[-:]/g,'').split('.')[0]}
SUMMARY:Cita con ${data.name}
DESCRIPTION:${data.message} | Email: ${data.email}
END:VEVENT
END:VCALENDAR`;

        const blob = new Blob([icsContent], { type: 'text/calendar' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `Cita_${data.name.replace(/ /g,'_')}.ics`;
        link.click();
    });
});
</script>
<footer>
    <p>
        Conéctate conmigo:
        <a href="mailto:paul.trujillo.hormigo@gmail.com">Email</a> |
        <a href="https://www.linkedin.com/in/paul-trujillo-319482209/">LinkedIn</a> |
        <a href="https://www.instagram.com/paultrujilloh">Instagram</a> |
        <a href="https://www.instagram.com/senorchilaquilmx/">Señor Chilaquil</a>
    </p>
</footer>
</body>
</html>
